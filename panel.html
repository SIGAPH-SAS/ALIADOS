<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel Aliados | SIGAPH S.A.S.</title>
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      margin: 0;
      background: #f4f7fb;
      color: #333;
      text-align: center;
    }

    header {
      background: #fff;
      color: #0a7b40;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .panel-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
    }

    .panel-logo img {
      height: 60px;
      margin-right: 12px;
    }

    nav {
      background: #0a7b40;
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    nav button {
      background: #fff;
      color: #0a7b40;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    nav button:hover {
      background: #002b5c;
      color: #fff;
    }

    main {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }

    section {
      display: none;
      margin-top: 20px;
    }

    section.activo {
      display: block;
    }

    .acciones {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 10px 16px;
      background: #0a7b40;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }

    .btn:hover {
      background: #086632;
    }

    .logout-btn {
      background: #c0392b;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .logout-btn:hover {
      background: #a12e22;
    }

    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-family: inherit;
    }

    .readonly {
      background: #f0f0f0;
    }

    .btn-aliado {
      display: inline-block;
      background: #002b5c;
      color: white;
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      margin: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-aliado:hover {
      background: #0a7b40;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #e9f5ee;
    }

    #logoCentral {
      display: block;
      margin: 30px auto;
      height: 120px;
    }

  </style>
</head>
<body>
  <header>
    <div class="panel-logo">
      <img id="logoUsuario" src="" alt="Logo Usuario">
      <h1>SIGAPH — Panel de Aliados</h1>
    </div>
    <div>
      <span id="bienvenida"></span>
      <button id="cerrarSesion" class="logout-btn">Cerrar sesión</button>
    </div>
  </header>

  <nav>
    <button onclick="mostrarSeccion('inicio')">Inicio</button>
    <button onclick="mostrarSeccion('reporte')">Generar Reporte</button>
    <button onclick="mostrarSeccion('control')">Control de Aliados</button>
  </nav>

  <main>
    <section id="inicio" class="activo">
      <img id="logoCentral" src="" alt="Logo central">
      <h2>Bienvenido al Panel</h2>
      <p>Desde aquí podrás generar reportes técnicos y visualizar información.</p>
    </section>

    <section id="reporte">
      <h2>Generar Reporte</h2>
      <form id="reporteForm">
        <label>Nombre de la empresa *</label>
        <input id="empresa" type="text" readonly class="readonly">

        <label>Fecha *</label>
        <input id="fecha" type="date" readonly class="readonly">

        <label>Hora *</label>
        <input id="hora" type="time" readonly class="readonly">

        <label>Lugar o unidad residencial *</label>
        <input id="lugar" required>

        <label>Descripción o diagnóstico *</label>
        <textarea id="descripcion" rows="4" required></textarea>

        <div class="acciones">
          <button type="submit" class="btn">Finalizar / Enviar</button>
          <button type="button" class="btn" onclick="mostrarSeccion('inicio')">Volver</button>
        </div>
      </form>
    </section>

    <section id="control">
      <h2>Control de Aliados</h2>
      <div id="contenidoControl"></div>
      <div id="detalleAliado"></div>
    </section>
  </main>

  <script>
    const auth = JSON.parse(localStorage.getItem('aliado_autenticado') || 'null');
    if (!auth) window.location.href = 'login.html';

    const logoMap = {
      'SIGAPH':'logo_sigaph1.png',
      'CT_ELECTRIC':'logo_usuario2.png',
      'CONSTRUCTORA_BETHEL':'logo_usuario3.png',
      'COMUNIDAD_FELIZ':'logo_usuario4.png',
      'TECHOS_RENTABLES':'logo_usuario5.png',
      'JL_ASESORIAS':'logo_usuario6.png',
      'aliado07':'logo_usuario7.png',
      'aliado08':'logo_usuario8.png',
      'aliado09':'logo_usuario9.png',
      'aliado10':'logo_usuario10.png'
    };

    document.getElementById('logoUsuario').src = logoMap[auth.username] || 'logo_sigaph1.png';
    document.getElementById('logoCentral').src = logoMap[auth.username] || 'logo_sigaph1.png';
    document.getElementById('bienvenida').textContent = `Bienvenido, ${auth.username}`;

    document.getElementById('cerrarSesion').addEventListener('click', ()=>{
      localStorage.removeItem('aliado_autenticado');
      window.location.href = 'login.html';
    });

    window.mostrarSeccion = id=>{
      document.querySelectorAll('main section').forEach(s=>s.classList.remove('activo'));
      document.getElementById(id).classList.add('activo');
      if(id==='reporte') autollenarFormulario();
      if(id==='control') inicializarControl();
    };

    function autollenarFormulario(){
      const hoy = new Date();
      document.getElementById('empresa').value = auth.username;
      document.getElementById('fecha').value = hoy.toISOString().split('T')[0];
      document.getElementById('hora').value = hoy.toTimeString().slice(0,5);
    }

    // Control de aliados funcional
    function inicializarControl(){
      const cont = document.getElementById('contenidoControl');
      const detalle = document.getElementById('detalleAliado');
      if(auth.username !== 'SIGAPH'){
        cont.innerHTML = "<p style='color:#c0392b'>Solo el usuario principal SIGAPH puede acceder al control general.</p>";
        detalle.innerHTML = "";
        return;
      }

      const aliados = ['CT_ELECTRIC','CONSTRUCTORA_BETHEL','COMUNIDAD_FELIZ','TECHOS_RENTABLES','JL_ASESORIAS','aliado07','aliado08','aliado09','aliado10'];
      cont.innerHTML = "<p>Seleccione un aliado para ver sus reportes:</p>" + aliados.map(a=>`<button class='btn-aliado' onclick='verReportes("${a}")'>${a}</button>`).join('');
    }

    // Mostrar reportes simulados (preparado para PDF reales)
    function verReportes(nombre){
      const detalle = document.getElementById('detalleAliado');
      const reportes = JSON.parse(localStorage.getItem('reportes_'+nombre) || '[]');
      if(reportes.length === 0){
        detalle.innerHTML = `<h3>Reportes de ${nombre}</h3><p>No hay reportes registrados aún.</p>`;
        return;
      }
      let html = `<h3>Reportes de ${nombre}</h3><table><thead><tr><th>PDF</th><th>Fecha</th><th>Descripción</th></tr></thead><tbody>`;
      reportes.forEach(r=>{
        html += `<tr><td><a href='${r.pdf}' target='_blank'>Ver PDF</a></td><td>${r.fecha}</td><td>${r.descripcion}</td></tr>`;
      });
      html += `</tbody></table>`;
      detalle.innerHTML = html;
    }

    document.getElementById('reporteForm').addEventListener('submit',e=>{
      e.preventDefault();
      alert('Reporte generado exitosamente para ' + auth.username);
      mostrarSeccion('inicio');
    });
  </script>
</body>
</html>
